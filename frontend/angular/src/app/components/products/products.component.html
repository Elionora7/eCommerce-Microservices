<h3 class="page-header flex">
    <span>Products</span>
    <span class="spacer"></span>
    <a [routerLink]="['/products', 'create']" mat-button color="primary"
        *ngIf="usersService.isAuthenticated && usersService.isAdmin">
        <mat-icon>add</mat-icon>New Product
    </a>
</h3>

<!-- Loading state -->
<div *ngIf="!products?.length" class="loading-state">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading products...</p>
</div>

<!-- Products table -->
<table mat-table [dataSource]="products" class="mat-elevation-z8" *ngIf="products?.length">

    <!-- Name Column -->
    <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Product Name</th>
        <td mat-cell *matCellDef="let product"> 
            <div class="product-info">
                <img [src]="product.imgUrl || 'assets/placeholder.jpg'" 
                     [alt]="product.name"
                     class="product-image"
                     (error)="handleImageError($event)">
                <span class="product-name">{{ product.name }}</span>
            </div>
        </td>
    </ng-container>

    <!-- Category Column -->
    <ng-container matColumnDef="category">
        <th mat-header-cell *matHeaderCellDef>Category</th>
        <td mat-cell *matCellDef="let product"> 
            <span class="category-badge">{{ product.category }}</span>
        </td>
    </ng-container>

    <!-- Unit Price Column -->
    <ng-container matColumnDef="unitPrice">
        <th mat-header-cell *matHeaderCellDef>Unit Price</th>
        <td mat-cell *matCellDef="let product"> 
            <span class="price">{{ product.unitPrice | currency }}</span>
        </td>
    </ng-container>

    <!-- Quantity Column -->
    <ng-container matColumnDef="quantity">
        <th mat-header-cell *matHeaderCellDef>Quantity in Stock</th>
        <td mat-cell *matCellDef="let product"> 
            <span [class]="'quantity ' + (product.quantity > 0 ? 'in-stock' : 'out-of-stock')">
                {{ product.quantity }}
                <span class="status-text">{{ product.quantity > 0 ? 'In Stock' : 'Out of Stock' }}</span>
            </span>
        </td>
    </ng-container>

    <!-- Action Column -->
    <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef> Actions </th>
        <td mat-cell *matCellDef="let product">
            <div class="action-buttons">
                <button mat-icon-button color="primary" 
                    *ngIf="usersService.isAuthenticated && usersService.isAdmin"
                    (click)="edit(product)" 
                    matTooltip="Edit Product">
                    <mat-icon>edit</mat-icon>
                </button>

                <button mat-icon-button color="warn" 
                    *ngIf="usersService.isAuthenticated && usersService.isAdmin"
                    (click)="delete(product)"
                    matTooltip="Delete Product">
                    <mat-icon>delete</mat-icon>
                </button>

                <!-- View details button for all users -->
                <button mat-icon-button color="accent"
                    (click)="viewDetails(product)"
                    matTooltip="View Details">
                    <mat-icon>visibility</mat-icon>
                </button>
            </div>
        </td>
    </ng-container>

    <!-- Define table rows -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
</table>

<!-- Empty state -->
<div *ngIf="products?.length === 0" class="empty-state">
    <mat-icon>inventory_2</mat-icon>
    <h3>No Products Found</h3>
    <p>There are no products available at the moment.</p>
    <a [routerLink]="['/products', 'create']" mat-flat-button color="primary"
        *ngIf="usersService.isAuthenticated && usersService.isAdmin">
        <mat-icon>add</mat-icon>Create First Product
    </a>
</div>